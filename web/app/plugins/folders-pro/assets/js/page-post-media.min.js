!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):"undefined"!=typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}(function($,f){var g,h,i,j,k,l,m="",n=[],o=-1,p=0,q=0,r="",s=-1,t=0,u="",v=folders_media_options.page_url,w="",x="",y=!1,z=!1,A=!1,B=0,C="",D=0,E=[],F=null,G=null,H=0,I=0,J="",K="",L=0,M=0,N=0,O=0,P=wp.media.view.AttachmentFilters.extend({id:"media-attachment-taxonomy-filter",createFilters:function(){var a={};folders_media_options.terms.length,_.each(folders_media_options.terms||{},function(b,c){a[b.term_id]={text:b.name+" ("+b.trash_count+")",props:{media_folder:b.slug}}}),a.all={text:"All Folders",props:{media_folder:""},priority:10},a.unassigned={text:"(Unassigned)",props:{media_folder:"-1"},priority:10},this.filters=a},change:function(){var a={};_.each(folders_media_options.terms||{},function(b,c){a[b.term_id]={text:b.name+" ("+b.count+")",props:{media_folder:b.slug}}}),a.all={text:"Select a folder >>",props:{media_folder:""},priority:10},a.unassigned={text:"(Unassigned)",props:{media_folder:"-1"},priority:10},this.filters=a;var b=this.filters[this.el.value];b&&this.model.set(b.props)}}),Q=0,R=0,S=[],T=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createToolbar:function(){T.prototype.createToolbar.call(this),this.toolbar.set("MediaLibraryOrganizerTaxonomyFilter",new P({controller:this.controller,model:this.collection.props,priority:-75}).render())}});var U=wp.media.view.AttachmentFilters.extend({id:"media-attachment-dynamic-filter",createFilters:function(){var a={};folders_media_options.dynamic_folders.length,_.each(folders_media_options.dynamic_folders||{},function(b,c){a[b.value]={text:b.name,props:{dynamic_media_folder:b.value}}}),this.filters=a},change:function(){var b={};_.each(folders_media_options.dynamic_folders||{},function(a,c){b[a.value]={text:a.name,props:{dynamic_media_folder:a.value}}}),this.filters=b;var a=this.filters[this.el.value];a&&this.model.set(a.props)}}),V=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createToolbar:function(){V.prototype.createToolbar.call(this),this.toolbar.set("DynamicTaxonomyFilter",new U({controller:this.controller,model:this.collection.props,priority:-75}).render())}});var d,e=wp.media.model.Query;_.extend(e,{get:(d=[],function(a,f){var b,c={},g=e.orderby,h=e.defaultProps,i=!1;return delete a.query,delete a.cache,_.defaults(a,h),_.each(["include","exclude"],function(b){a[b]&&!_.isArray(a[b])&&(a[b]=[a[b]])}),_.each(a,function(a,b){_.isNull(a)||(c[e.propmap[b]||b]=a)}),_.defaults(c,e.defaultArgs),c.orderby=g.valuemap[a.orderby]||a.orderby,d=[],b||(b=new e([],_.extend(f||{},{props:a,args:c})),d.push(b)),b})});var a=window.wp;void 0!==a&&"function"==typeof a.Uploader&&(a.media.view.Modal.prototype.on("open",function(){m="",setTimeout(function(){$(".folder-modal #media-attachment-taxonomy-filter").length&&("all"==$(".folder-modal #media-attachment-taxonomy-filter").val()&&($(".folder-modal #media-attachment-taxonomy-filter option:gt(1)").remove(),_.each(folders_media_options.terms,function(a,b){$(".folder-modal #media-attachment-taxonomy-filter").append("<option value='"+a.term_id+"'>"+a.name+" ("+a.trash_count+")</option>")})),!$("#wcp-content").length&&$(".editor-post-featured-image").length&&$(".attachment-filters").val("all").trigger("change"))},200)}),a.media.view.Modal.prototype.on("close",function(){m=""}),$.extend(a.Uploader.prototype,{progress:function(){},init:function(){this.uploader&&(this.uploader.bind("FileFiltered",function(a,b){Q++,$(".folder-meter").css("width","0%"),$(".media-folder-loader").show(),$("#total_upload_files").text(Q)}),this.uploader.bind("BeforeUpload",function(b,e){var a=o,c=b.settings.multipart_params;if((a=parseInt(a))>0&&(c.folder_for_media=a),R<Q){$(".media-folder-loader").show();var d=R/Q*100;$(".folder-meter").css("width",d+"%")}R++,$("#current_upload_files").text(R)}),this.uploader.bind("UploadComplete",function(a,b){o=-1}),this.uploader.bind("UploadComplete",function(b,c){var a=window.wp;$(".folder-meter").css("width","100%"),setTimeout(function(){$(".media-folder-loader").hide(),$(".folder-meter").css("width","0%"),Q=0,R=0},1250),an(),void 0!==a.media.frame&&null!==a.media.frame.content.get()&& void 0!==a.media.frame.content.get().collection?(m="",$(".folder-modal ul.attachments li.selected").length&&(m=$(".folder-modal ul.attachments li.selected").data("id")),a.media.frame.content.get().collection.props.set({ignore:+new Date}),a.media.frame.content.get().options.selection.reset()):$("#media-attachment-taxonomy-filter").length&&$(".attachment-filters").each(function(){$(this).trigger("change")})}))}}));var c=window.wp;if(void 0!==c&&"function"==typeof c.Uploader){var b=window.wp.media,W=b.view.Modal;b.view.Modal=b.view.Modal.extend({className:"folder-modal",initialize:function(){W.prototype.initialize.apply(this,arguments)},open:function(){W.prototype.open.apply(this,arguments)&&(!$(".folder-modal").length&&$(".supports-drag-drop").length&&$(".supports-drag-drop").each(function(){("block"==$(this).css("display")||"inline-block"==$(this).css("display"))&&$(this).addClass("folder-modal")}),$(".folder-modal").length?($(".folder-custom-menu").remove(),$(".folder-modal .media-frame-tab-panel").removeClass("has-folder-menu"),$(".folder-modal .media-frame").hasClass("hide-menu")?$(".folder-custom-menu").length||($(".folder-modal .media-frame-tab-panel").before("<div class='folder-custom-menu'><div class='folder-menu-content'><div class='cssload-container'><div class='cssload-tube-tunnel'></div></div></div></div>"),$(".folder-modal .folder-menu-content").load(folders_media_options.media_page_url+"?media_folder= #wcp-content-resize",function(){at(),ai(),Z()})):$(".folder-custom-menu").length||($(".folder-modal .media-frame-menu").addClass("has-folder-menu"),$(".folder-modal .media-frame-menu .media-menu").append("<div class='folder-custom-menu'><div class='folder-menu-content'><div class='cssload-container'><div class='cssload-tube-tunnel'></div></div></div></div>"),$(".folder-modal .folder-menu-content").load(folders_media_options.media_page_url+"?media_folder= #wcp-content-resize",function(){at(),ai(),Z()})),$(".folder-form-data").remove(),$(".media-frame-tab-panel:first").before("<div class='folder-form-data'></div>"),$(".folder-form-data").load(folders_media_options.media_page_url+"?media_folder= #folder-add-update-content",function(){})):setTimeout(function(){-1!=o&&$("#media-attachment-taxonomy-filter").each(function(){$(this).val(o),$(this).trigger("change")})},1e3))},close:function(){W.prototype.close.apply(this,arguments),$(".folder-modal").removeClass("folder-modal")}})}function X(){"yes"==folders_media_options.useFolderUndo&&($("#do-undo").addClass("active"),$(".undo-folder-action").removeClass("disabled"),setTimeout(function(){$("#do-undo").removeClass("active"),$(".undo-folder-action").addClass("disabled")},parseInt(folders_media_options.defaultTimeout)))}function Y(){$("#js-tree-menu .jstree-anchor:not(.ui-droppable)").droppable({accept:".wcp-move-file, .wcp-move-multiple, .attachments-browser li.attachment",hoverClass:"wcp-drop-hover",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(b,a){p=$(this).closest("li.jstree-node").attr("id"),$(".media-modal #js-tree-menu .jstree-clicked").length&&(w=$(".media-modal #js-tree-menu .jstree-clicked").closest(".jstree-node").attr("id")),a.draggable.hasClass("wcp-move-multiple")?$(".wp-list-table input:checked").length&&(chkStr="",$(".wp-list-table input:checked").each(function(){chkStr+=$(this).val()+","}),u=af(p,"nonce"),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+p+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+w,method:"post",success:function(a){"1"==(a=$.parseJSON(a)).status?(aj(),X()):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show())}})):a.draggable.hasClass("wcp-move-file")?(postID=a.draggable[0].attributes["data-id"].nodeValue,u=af(p,"nonce"),chkStr=postID+",",$(".wp-list-table input:checked").each(function(){$(this).val()!=postID&&(chkStr+=$(this).val()+",")}),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+p+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+w,method:"post",success:function(a){"1"==(a=$.parseJSON(a)).status?(aj(),X()):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show())}})):a.draggable.hasClass("attachment")&&(chkStr=a.draggable[0].attributes["data-id"].nodeValue,u=af(p,"nonce"),$(".attachments-browser li.attachment.selected").length>1&&(chkStr="",$(".attachments-browser li.attachment.selected").each(function(){chkStr+=$(this).data("id")+","})),x=chkStr,$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+p+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+w,method:"post",success:function(a){aj(),X(),av()}}))}}),$(".media-frame:not(.hide-router) .attachments-browser li.attachment:not(.ui-draggable)").draggable({revert:"invalid",containment:"document",helper:function(b,c){$(".selected-items").remove();var a=$(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").length;return $("<div class='selected-items'><span class='total-post-count'>"+(a=0==a||1==a?"1 Item":a+" Items")+" Selected</span></div>")},start:function(a,b){$("body").addClass("no-hover-css")},cursor:"move",appendTo:".media-modal",cursorAt:{left:0,top:0},stop:function(a,b){$(".selected-items").remove(),$("body").removeClass("no-hover-css")}}),$(".un-categorised-items:not(.ui-droppable)").droppable({accept:".wcp-move-file, .wcp-move-multiple, .attachments-browser li.attachment",hoverClass:"wcp-hover-list",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(b,a){p=-1,u=folders_media_options.nonce,a.draggable.hasClass("wcp-move-multiple")?$(".wp-list-table input:checked").length&&(chkStr="",$(".wp-list-table input:checked").each(function(){chkStr+=$(this).val()+","}),aa(chkStr)):a.draggable.hasClass("wcp-move-file")?(chkStr=(postID=a.draggable[0].attributes["data-id"].nodeValue)+",",$(".wp-list-table input:checked").each(function(){postID!=$(this).val()&&(chkStr+=$(this).val()+",")}),aa(chkStr)):a.draggable.hasClass("attachment")&&(chkStr=a.draggable[0].attributes["data-id"].nodeValue,$(".attachments-browser li.attachment.selected").length>1&&(chkStr="",$(".attachments-browser li.attachment.selected").each(function(){chkStr+=$(this).data("id")+","})),x=chkStr,aa(chkStr))}}),$(".tree-structure .folder-item:not(.ui-droppable)").droppable({accept:".wcp-move-file, .wcp-move-multiple, .attachments-browser li.attachment",hoverClass:"wcp-drop-hover-list",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(b,a){$("body").removeClass("no-hover-css"),$(".media-modal #js-tree-menu .jstree-clicked").length&&(w=$(".media-modal #js-tree-menu .jstree-clicked").closest(".jstree-node").attr("id")),p=$(this).data("id"),a.draggable.hasClass("wcp-move-multiple")?(u=af(p,"nonce"),$(".wp-list-table input:checked").length&&(chkStr="",$(".wp-list-table input:checked").each(function(){chkStr+=$(this).val()+","}),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+p+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+w,method:"post",success:function(a){aj(),av(),X()}}))):a.draggable.hasClass("wcp-move-file")?(postID=a.draggable[0].attributes["data-id"].nodeValue,u=af(p,"nonce"),chkStr=postID+",",$(".wp-list-table input:checked").each(function(){$(this).val()!=postID&&(chkStr+=$(this).val()+",")}),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+p+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+w,method:"post",success:function(a){aj(),av(),X()}})):a.draggable.hasClass("attachment")&&(chkStr=a.draggable[0].attributes["data-id"].nodeValue,u=af(p,"nonce"),$(".attachments-browser li.attachment.selected").length>1&&(chkStr="",$(".attachments-browser li.attachment.selected").each(function(){chkStr+=$(this).data("id")+","})),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+p+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+w,method:"post",success:function(a){aj(),av(),X()}}))}}),$(".sticky-folders > ul > li > a:not(.ui-droppable)").droppable({accept:".wcp-move-file, .wcp-move-multiple, .media-frame:not(.hide-router) .attachments-browser li.attachment",hoverClass:"wcp-drop-hover",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(d,b){if(p=$(this).closest("li").data("folder-id"),$(".media-modal #js-tree-menu .jstree-clicked").length&&(w=$(".media-modal #js-tree-menu .jstree-clicked").closest(".jstree-node").attr("id")),b.draggable.hasClass("wcp-move-multiple")){if($(".wp-list-table input:checked").length){var a="";$(".wp-list-table input:checked").each(function(){a+=$(this).val()+","}),u=af(p,"nonce"),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+a+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+p+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+w,method:"post",success:function(a){"1"==(a=$.parseJSON(a)).status?(aj(),av(),X()):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show())}})}}else if(b.draggable.hasClass("wcp-move-file")){var c=b.draggable[0].attributes["data-id"].nodeValue;u=af(p,"nonce"),a=c+",",$(".wp-list-table input:checked").each(function(){$(this).val()!=c&&(a+=$(this).val()+",")}),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+a+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+p+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+w,method:"post",success:function(a){var a=$.parseJSON(a);"1"==a.status?(aj(),X(),av()):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show())}})}else if(b.draggable.hasClass("attachment")){var a=b.draggable[0].attributes["data-id"].nodeValue;u=af(p,"nonce"),$(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").length>1&&(a="",$(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").each(function(){a+=$(this).data("id")+","})),x=a,$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+a+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+p+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+w,method:"post",success:function(a){aj(),X(),av()}})}}})}function Z(){$("#dynamic-tree-folders").jstree({core:{cache:!1,animation:0,dnd:{is_draggable:function(a){return!1}}},data:{cache:!1},select_node:!1,search:{show_only_matches:!0,case_sensitive:!1,fuzzy:!1},plugins:["dnd","search"]}).bind("ready.jstree",function(){$(".dynamic-tree-data").show()}),$(".upload-media-action").removeClass("disabled"),$("#upload_media_folder").prop("disabled",!1),$(".folder-modal #js-tree-menu").jstree({core:{cache:!1,animation:0,check_callback:function(b,c,d,e,a){if($("*").removeClass("drag-bot").removeClass("drag-in").removeClass("drag-up"),("move_node"===b||"copy_node"===b)&&a&&a.dnd)switch(a.pos){case"a":a.origin.get_node(a.ref,!0).addClass("drag-bot"),nodeId=$(".drag-bot").attr("id"),$("#jstree-dnd").text("Below "+$.trim($("#js-tree-menu").jstree(!0).get_node(nodeId).text));break;case"i":a.origin.get_node(a.ref,!0).addClass("drag-in"),nodeId=$(".drag-in").attr("id"),$("#jstree-dnd").text("Inside "+$.trim($("#js-tree-menu").jstree(!0).get_node(nodeId).text));break;case"b":a.origin.get_node(a.ref,!0).addClass("drag-up"),nodeId=$(".drag-up").attr("id"),$("#jstree-dnd").text("Above "+$.trim($("#js-tree-menu").jstree(!0).get_node(nodeId).text));break;default:$("#jstree-dnd").text($("#jstree-dnd").data("txt"))}return!0}},dnd:{is_draggable:function(a){return!($(".jstree-node[id='"+(folderMoveId=a[0].id)+"']").length&&$(".jstree-node[id='"+folderMoveId+"']").hasClass("is-locked"))}},data:{cache:!1},select_node:!1,search:{show_only_matches:!0,case_sensitive:!1,fuzzy:!1},plugins:["dnd","search","contextmenu"],contextmenu:{select_node:0,show_at_node:0,items:function(){return{}}}}).bind("ready.jstree",function(){if(ae(),Y(),ah(),""!=folders_media_options.default_folder&&0!=folders_media_options.default_folder){var a=function(a){if(n.length>0){for(i=0;i<n.length;i++)if(n[i].slug==a)return n[i].folder_id}return""}(folders_media_options.default_folder);""!=a&&$(".folder-modal #media-attachment-taxonomy-filter option[value='"+a+"']").length&&($(".folder-modal #media-attachment-taxonomy-filter").val(a).trigger("change"),$(".folder-modal #js-tree-menu .jstree-clicked").removeClass("jstree-clicked"),$(".folder-modal #js-tree-menu").jstree("select_node",a),$(".folder-modal #js-tree-menu .jstree-node[id='"+a+"'] > a").addClass("jstree-clicked"))}ad()}).bind("after_open.jstree",function(){Y()}).bind("open_all.jstree",function(){Y()}).bind("create_node.jstree",function(){Y()}).bind("delete_node.jstree",function(){Y()}).bind("close_all.jstree",function(){Y()}).bind("after_close.jstree",function(){Y()}).bind("move_node.jstree",function(b,a){"#"!=a.node.parent&&$("#js-tree-menu").jstree("open_node",a.node.parent),folderMoveId=a.node.id,orderString="",$(".folder-modal .jstree-node[id='"+folderMoveId+"']").closest("ul").children().each(function(){"undefined"!=$(this).attr("id")&&(orderString+=$(this).attr("id")+",")}),parentID=$(".folder-modal #"+folderMoveId+"_anchor").closest(".jstree-node").parent().parent().hasClass("jstree-node")?$("#"+folderMoveId+"_anchor").closest(".jstree-node").parent().parent().attr("id"):0,""!=orderString&&(i=a.old_parent,j=a.old_position,k=folderMoveId,$(".form-loader-count").css("width","100%"),$.ajax({url:folders_media_options.ajax_url,data:{term_ids:orderString,action:"wcp_save_folder_order",type:folders_media_options.post_type,nonce:folders_media_options.nonce,term_id:folderMoveId,parent_id:parentID},method:"post",success:function(a){"1"==(a=$.parseJSON(a)).status?($("#wcp_folder_parent").html(a.options),$(".form-loader-count").css("width","0"),aj(),av(),ao(),Y()):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show(),window.location.reload(!0))}}))}),Y()}function aa(a){$(".folder-modal #js-tree-menu .jstree-anchor.jstree-clicked").length?(w=$(".folder-modal #js-tree-menu .jstree-anchor.jstree-clicked").closest(".jstree-node").attr("id"),$.ajax({url:folders_media_options.ajax_url,data:{post_id:a,action:"premio_check_for_other_folders",active_folder:w,type:folders_media_options.post_type,folder_id:-1,nonce:folders_media_options.nonce,status:folders_media_options.taxonomy_status,taxonomy:w},method:"post",success:function(a){-1==(a=$.parseJSON(a)).status?($("#unassigned_folders").val(a.data.post_id),$("#confirm-your-change").show()):(aj(),X())}})):(u=folders_media_options.nonce,$.ajax({url:folders_media_options.ajax_url,data:"post_id="+a+"&type="+folders_media_options.post_type+"&action=wcp_remove_post_folder&folder_id=-1&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+w,method:"post",success:function(a){aj(),X()}}))}function ab(a,b){$(".form-loader-count").css("width","100%"),$.ajax({url:folders_media_options.ajax_url,data:{copy_from:a,copy_to:b,action:"copy_premio_folders",nonce:folders_media_options.nonce,post_type:folders_media_options.post_type},method:"post",success:function(a){if(1==(a=$.parseJSON(a)).status&&(M=a.parent_id,a.data.length>0))for(var b=0;b<a.data.length;b++)ac(a.data[b]);av()}})}function ac(a){var d={folder_id:a.term_id,folder_count:0,is_sticky:a.is_sticky,is_high:a.is_high,is_locked:a.is_locked,nonce:a.nonce,slug:a.slug,is_deleted:0};n.push(d);var b=a.title;if(b=b.replace(/\\/g,""),$("#js-tree-menu").jstree().create_node(a.parent_id,{id:a.term_id,text:b},"last",function(){$(".jstree-node[id='"+a.term_id+"']").attr("data-nonce",a.nonce),$(".jstree-node[id='"+a.term_id+"']").attr("data-slug",a.slug)}),a.child.length>0)for(var c=0;c<a.child.length;c++)ac(a.child[c]);ak(),ah(),aj(),$(".folders-undo-notification").removeClass("active"),$("#paste-message").addClass("active"),setTimeout(function(){$("#paste-message").removeClass("active")},5e3)}function ad(){$(".cut-folder-action, .copy-folder-action, .paste-folder-action, .delete-folder-action").addClass("disabled"),$("#js-tree-menu .jstree-anchor.jstree-clicked").length&&($(".cut-folder-action, .copy-folder-action, .delete-folder-action").removeClass("disabled"),""!=I&&0!=I&&w!=I&&$(".paste-folder-action").removeClass("disabled")),$(".all-posts").hasClass("active-item")&&""!=I&&0!=I&&$(".paste-folder-action").removeClass("disabled"),($("#menu-checkbox").is(":checked")||$("#menu-checkbox").is(":checked"))&&$("#js-tree-menu input.checkbox:checked").length>0&&$(".delete-folder-action").removeClass("disabled")}function ae(){$("#js-tree-menu .jstree-node").each(function(){var a=parseInt($(this).data("count"));a>0?$(".jstree-node[id='"+$(this).attr("id")+"'] > a span.premio-folder-count").text(a):$(".jstree-node[id='"+$(this).attr("id")+"'] > a span.premio-folder-count").text(0)}),""!=w&&0!=w&&$(".jstree-node[id='"+w+"']").length&&($("#js-tree-menu").jstree("select_node",w),$(".sticky-folders .sticky-folder-"+w+" a").length&&$(".sticky-folders .sticky-folder-"+w+" a").addClass("active-item")),$(".ajax-preloader").hide(),$(".js-tree-data").show(),ai(),ah(),$(".sticky-folders ul > li").length>0&&$(".sticky-folders").addClass("active"),al()}function af(a,b){if(n.length>0){for(i=0;i<n.length;i++)if(parseInt(n[i].folder_id)==parseInt(a))return n[i][b]}return""}function ag(a){if(n.length>0){for(i=0;i<n.length;i++)if(parseInt(n[i].folder_id)==parseInt(a))return i}return null}function ah(){$(".sticky-folders > ul").html("");var a="";if($("#js-tree-menu li.jstree-node.is-sticky").each(function(){var b=$(this).attr("id"),c=$.trim($("#js-tree-menu").jstree(!0).get_node(b).text),d=$("#"+b+"_anchor .premio-folder-count").text(),e=$("li.jstree-node[id='"+b+"']").hasClass("is-high")?" is-high ":"",f=$("li.jstree-node[id='"+b+"']").hasClass("is-locked")?" is-locked ":"";a+="<li data-folder-id='"+b+"' class='sticky-fldr "+e+" "+f+" sticky-folder-"+b+"'><a href='javascript:;'><span class='folder-title'>"+c+"</span><span class='folder-actions'><span class='update-inline-record'><i class='pfolder-edit-folder'></i></span><span class='star-icon'><i class='pfolder-star'></i></span><span class='dashicons dashicons-lock'></span><span class='premio-folder-count'>"+d+"</span></span></a></li>"}),$(".sticky-folders > ul").html(a),$(".jstree-anchor.jstree-clicked").length){var b=$(".jstree-anchor.jstree-clicked").closest("li.jstree-node").attr("id");$(".sticky-folders .sticky-folder-"+b+" a").addClass("active-item")}$(".sticky-folders > ul > li").length>0?$(".sticky-folders").addClass("active"):$(".sticky-folders").removeClass("active"),ai()}function ai(){var c=0;if($("#custom-scroll-menu").hasClass("mCustomScrollbar")){var a=$("#custom-scroll-menu"),d=a.find(".mCSB_dragger"),e=a.find(".mCSB_container").height();c=d.position().top/(a.height()-d.height())*(e-a.height()),$("#custom-scroll-menu").mCustomScrollbar("destroy")}var b=parseInt($(".folder-modal .media-modal-content").height())-parseInt($(".folder-modal .sticky-wcp-custom-form").height())-40;$(".folder-modal #custom-scroll-menu").closest(".media-frame-menu").length&&$(".folder-custom-menu").length&&$(".media-frame-menu").length&&(b=parseInt($(".folder-modal .media-modal-content").height())-parseInt($(".folder-modal .sticky-wcp-custom-form").height())-40,$(".folder-modal .folder-custom-menu").length&&$(".folder-modal .media-modal-content").length),b<0&&(b=350),$("#custom-scroll-menu").mCustomScrollbar({axis:"y",scrollButtons:{enable:!0},setHeight:b,theme:"3d",scrollbarPosition:"inside",scrollInertia:500,mouseWheelPixels:60}),0!=c&&$("#custom-scroll-menu").mCustomScrollbar("scrollTo",c+"px",{scrollInertia:0})}function aj(){if($(".media-toolbar").hasClass("media-toolbar-mode-select")&&$("ul.attachments li.selected").length&&($("ul.attachments li.selected").trigger("click"),$(".select-mode-toggle-button").trigger("click")),""!=x&&($("#js-tree-menu a.jstree-clicked").length>0||"-1"==w)){if($("#media-attachment-taxonomy-filter").length){x=x.split(",");for(var a=0;a<x.length;a++)""!=x[a]&&$(".attachments-browser li[data-id='"+x[a]+"']").remove()}x=""}$("#media-attachment-taxonomy-filter").length?au(0):($.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=get_folders_default_list",method:"post",success:function(a){a=$.parseJSON(a),$(".header-posts .total-count").text(a.total_items),$(".un-categorised-items .total-count").text(a.empty_items),E=a.taxonomies,ao()}}),$(".folder-loader-ajax").addClass("active"),$("#folder-posts-filter").length?$("#folder-posts-filter").load(v+" #posts-filter",function(){var a={Title:"",Url:v};history.pushState(a,a.Title,a.Url),"show"!=folders_media_options.show_in_page||$(".tree-structure").length||$(".wp-header-end").before('<div class="tree-structure-content"><div class="tree-structure"><ul></ul><div class="clear clearfix"></div></div></div>'),al(),am()}):$("#wpbody").load(v+" #wpbody-content",!1,function(b){var a={Title:"",Url:v};history.pushState(a,a.Title,a.Url),"show"!=folders_media_options.show_in_page||$(".tree-structure").length||$(".wp-header-end").before('<div class="tree-structure-content"><div class="tree-structure"><ul></ul><div class="clear clearfix"></div></div></div>'),al()}))}function ak(){al(),ah()}function al(){if(n.length){var a=0;$(".folder-modal #js-tree-menu li.jstree-node").each(function(){null!=(folderPostId=ag($(this).attr("id")))&&(1==n[folderPostId].is_high?$(this).addClass("is-high"):$(this).removeClass("is-high"),1==n[folderPostId].is_locked?($(this).addClass("is-locked"),a++):$(this).removeClass("is-locked"),1==n[folderPostId].is_sticky?$(this).addClass("is-sticky"):$(this).removeClass("is-sticky"),n[folderPostId].slug==folders_media_options.default_folder?$(this).addClass("is-current"):$(this).removeClass("is-current"))}),a>0&&a==$(".folder-modal #js-tree-menu li.jstree-node").length?$(".lock-unlock-all-folders").addClass("all-folder-locked").removeClass("open-folders").attr("data-folder-tooltip","Unlock all folders"):$(".lock-unlock-all-folders").addClass("open-folders").removeClass("all-folder-locked").attr("data-folder-tooltip","Lock all folders")}}function am(){al(),$(".form-loader-count").css("width","0"),"object"==typeof inlineEditPost&&(inlineEditPost.init(),$("#the-list").on("click",".editinline",function(){$(this).attr("aria-expanded","true"),inlineEditPost.edit(this)}),$(document).on("click",".inline-edit-save .save",function(){var a=$(this).closest("tr").attr("id");a=(a=a.replace("edit-","")).replace("post-",""),inlineEditPost.save(a)}),$(document).on("click",".inline-edit-save .cancel",function(){var a=$(this).closest("tr").attr("id");a=(a=a.replace("edit-","")).replace("post-",""),inlineEditPost.revert(a)})),"attachment"!=folders_media_options.post_type||($(".move-to-folder-top").length||$("#bulk-action-selector-top").append("<option class='move-to-folder-top' value='move_to_folder'>Move to Folder</option>"),$(".move-to-folder-bottom").length||$("#bulk-action-selector-bottom").append("<option class='move-to-folder-bottom' value='move_to_folder'>Move to Folder</option>"))}function an(){$("#media-attachment-taxonomy-filter").val(),l=$.ajax({url:folders_media_options.ajax_url,data:"type=attachment&action=wcp_get_default_list&active_id=0",method:"post",beforeSend:function(){null!=l&&l.abort()},success:function(a){var a=$.parseJSON(a);E=a.taxonomies,ao(),Y()}})}function ao(){if(al(),ah(),$("#media-attachment-taxonomy-filter").length&&($("#media-attachment-taxonomy-filter").each(function(){folders_media_options.terms=E;var b=$(this);currentDDVal=$(this).val(),b.html("<option value='all'>All Folders</option><option value='unassigned'>(Unassigned)</option>"),S=E;for(var a=0;a<E.length;a++)b.append("<option value='"+E[a].term_id+"'>"+E[a].name+" ("+E[a].trash_count+")</option>");0!=N?($(".jstree-clicked").removeClass("jstree-clicked"),$("#js-tree-menu").jstree("select_node",N),b.val(N).trigger("change")):b.val(currentDDVal).trigger("change")}),$("select.folder_for_media").length)){var b=$("select.folder_for_media").val();$("select.folder_for_media option:not(:first-child):not(:last-child)").remove();for(var a=0;a<E.length;a++)$("select.folder_for_media option:last-child").before("<option value='"+E[a].term_id+"'>"+E[a].name+"</option>");""!=b&&$(".folder_for_media").val(b)}for($("span.premio-folder-count").text(""),$(".folder-count").text(""),a=0;a<E.length;a++)0!=parseInt(E[a].trash_count)?($(".jstree-node[id='"+E[a].term_id+"'] > a.jstree-anchor span.premio-folder-count").text(E[a].trash_count),$(".sticky-folder-"+E[a].term_id+" .premio-folder-count").text(E[a].trash_count)):($(".jstree-node[id='"+E[a].term_id+"'] > a.jstree-anchor span.premio-folder-count").text(0),$(".sticky-folder-"+E[a].term_id+" .premio-folder-count").text(0));""!=w&&$("#wcp_folder_"+w).addClass("active-item"),z&&($("#title_"+q).trigger("click"),z=!1),N=0}function ap(){var a=$.trim($("#folder-search").val());$("#js-tree-menu").jstree("search",a)}function aq(c){var a="Are you sure you want to delete the selected folder?",b="Items in the folder will not be deleted.";if(y=!1,1==c&&$("#menu-checkbox").is(":checked")){var d=0;if($("#js-tree-menu input.checkbox:checked").each(function(){!$(this).closest("li.jstree-node").hasClass("is-locked")&&d++}),0==d)return;if(y=!0,0==$("#js-tree-menu input.checkbox:checked").length){$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html("Please select at least one folder to delete"),$("#error-folder-popup").show();return}$("#js-tree-menu input.checkbox:checked").length>1&&(a="Are you sure you want to delete the selected folders?",b="Items in the selected folders will not be deleted.")}$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#remove-folder-item").text("Yes, Delete it!"),$("#remove-folder-message").text(a),$("#remove-folder-notice").text(b),$("#confirm-remove-folder").show(),$("#remove-folder-item").focus()}function ar(){folderName=$.trim($("#js-tree-menu").jstree(!0).get_node(q).text),parentID=$("#wcp_folder_"+q).closest("li.jstree-node").data("folder-id"),parentID==f&&(parentID=0),$("#update-folder-data").text("Submit"),$(".folder-form-errors").removeClass("active"),$("#update-folder-item-name").val(folderName),$("#update-folder-item").removeClass("disabled"),$("#update-folder-item").show(),$("#update-folder-item-name").focus(),$(".dynamic-menu").remove()}function as(){if(0==t&&s>=10)return $("#folder-limitation-message").html("You've reached the 10 folder limitation!"),$("#no-more-folder-credit").show(),!1;$("#save-folder-data").text("Submit"),$(".folder-form-errors").removeClass("active"),$("#add-update-folder-name").val(""),A&&(B=q,$("#add-update-folder-name").val($.trim($("#js-tree-menu").jstree(!0).get_node(q).text)+" #2"),q=$("#"+q+"_anchor").closest(".jstree-node").parent().parent().hasClass("jstree-node")?$("#"+q+"_anchor").closest(".jstree-node").parent().parent().attr("id"):0),$("#add-update-folder").removeClass("disabled"),$("#add-update-folder").show(),$("#add-update-folder-name").focus(),$(".dynamic-menu").remove()}function at(){setTimeout(function(){if($("#js-tree-menu .jstree-node.jstree-leaf").length==$("#js-tree-menu .jstree-node").length)$("#expand-collapse-list").removeClass("all-open"),$("#expand-collapse-list").attr("data-folder-tooltip","Expand"),$("#expand-collapse-list .text").text("Expand");else{var a=$("#js-tree-menu .jstree-node.jstree-closed").length+$("#js-tree-menu .jstree-node.jstree-open").length;$("#js-tree-menu .jstree-node.jstree-closed").length==a?($("#expand-collapse-list").removeClass("all-open"),$("#expand-collapse-list").attr("data-folder-tooltip","Expand"),$("#expand-collapse-list .text").text("Expand")):($("#expand-collapse-list").addClass("all-open"),$("#expand-collapse-list").attr("data-folder-tooltip","Collapse"),$("#expand-collapse-list .text").text("Collapse"))}},500),Y()}function au(a){l=$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_get_default_list&active_id="+w,method:"post",beforeSend:function(){null!=l&&l.abort()},success:function(c){if(c=$.parseJSON(c),$(".header-posts .total-count").text(c.total_items),$(".un-categorised-items .total-count").text(c.empty_items),selectedVal=$("#media-attachment-taxonomy-filter").val(),"all"!=selectedVal&&1==a){var b=parent.wp;f!=b.media&&(b.media.frame.setState("insert"),null!==b.media.frame.content.get()&& void 0!==b.media.frame.content.get().collection?(b.media.frame.content.get().collection.props.set({ignore:+new Date}),b.media.frame.content.get().options.selection.reset()):b.media.frame.library.props.set({ignore:+new Date}))}E=c.taxonomies,ao(),Y()}})}function av(){$(".folder-loader-ajax").addClass("active"),$(".folder-loader-ajax img").removeClass("active"),$(".folder-loader-ajax svg#successAnimation").addClass("active").addClass("animated"),setTimeout(function(){$(".folder-loader-ajax").removeClass("active"),$(".folder-loader-ajax img").addClass("active"),$(".folder-loader-ajax svg#successAnimation").removeClass("active").removeClass("animated")},2e3),ah(),Y()}$(document).ready(function(){g=parseInt(folders_media_options.hasStars),h=parseInt(folders_media_options.hasChildren),H=parseInt(folders_media_options.hasValidLicense),$(document).on("click",".folder-settings-btn > a",function(a){a.stopPropagation(),$(".folder-settings-btn").toggleClass("active")}),$(document).on("click","body,html",function(){$(".folder-settings-btn").removeClass("active")}),$(document).on("click",".folder-setting-menu",function(a){a.stopPropagation()}),$(document).on("click",".lock-unlock-all-folders",function(){$(this).hasClass("open-folders")?$("#lock-all-folder-popup").show():$("#unlock-all-folder-popup").show()}),$(document).on("click",".lock-all-folder, .unlock-all-folder",function(b){var a=0;$(this).hasClass("lock-all-folder")&&(a=1),$(".folder-settings-btn").removeClass("active"),$(".form-loader-count").css("width","100%"),b.preventDefault(),$("#unlock-all-folder-popup, #lock-all-folder-popup").hide(),$.ajax({url:folders_media_options.ajax_url,data:{post_type:folders_media_options.post_type,nonce:folders_media_options.nonce,action:"premio_lock_unlock_all_folders",lock_folders:a},method:"post",success:function(a){if(a=$.parseJSON(a),$(".form-loader-count").css("width","0"),av(),1==a.status&&n.length>0)for(var b=0;b<n.length;b++)n[b].is_locked=a.data.is_locked;ak()}})}),$(document).on("change","#upload_media_folder",function(){var a=new FormData;if($("#upload_media_folder")[0].files.length){for(var b=0;b<$("#upload_media_folder")[0].files.length;b++)a.append("media_files_"+b,$("#upload_media_folder")[0].files[b]),a.append("media_file_name["+b+"]",$("#upload_media_folder")[0].files[b].webkitRelativePath);a.append("post_type",folders_media_options.post_type),a.append("nonce",folders_media_options.nonce),a.append("action","upload_premio_folder"),$(".form-loader-count").css("width","100%"),$.ajax({url:folders_media_options.ajax_url,type:"post",data:a,contentType:!1,processData:!1,success:function(a){if(1==(a=$.parseJSON(a)).status){var c=0;if(a.data.length>0)for(var b=0;b<a.data.length;b++){var e={folder_id:a.data[b].term_id,folder_count:0,is_sticky:a.data[b].is_sticky,is_high:a.data[b].is_high,is_locked:a.data[b].is_locked,nonce:a.data[b].nonce,slug:a.data[b].slug,is_deleted:0};0==c&&(c=a.data[b].term_id),n.push(e);var d=a.data[b].title;d=d.replace(/\\/g,""),$("#js-tree-menu").jstree().create_node(a.data[b].parent_id,{id:a.data[b].term_id,text:" "+d},"last",function(){$(".jstree-node[id='"+a.data[b].term_id+"']").attr("data-nonce",a.data[b].nonce),$(".jstree-node[id='"+a.data[b].term_id+"']").attr("data-slug",a.data[b].slug)})}0!=c&&(N=c),$(".form-loader-count").css("width","0px"),av(),$("#media-attachment-taxonomy-filter").length&&au(0),$("#upload_media_folder").val("")}}})}}),$(document).on("click",".close-popup-button",function(a){$(".folder-popup-form").hide(),$(".folder-modal .jstree-node[id='"+q+"']").length&&$(".folder-modal .jstree-node[id='"+q+"'] > a.jstree-anchor").trigger("focus")}),$(document).on("click",".thumbnail-hover-box a",function(a){return a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault(),window.open($(this).prop("href"),"_blank"),!1}),$(document).ajaxComplete(function(b,c,a){f!=a.data&&""!=a.data&&"string"==$.type(a.data)&&"string"==typeof a.data&& -1!=a.data.indexOf("action=query-attachments")&&Y(),""!=m&&$(".folder-modal ul.attachments li[data-id='"+m+"']").length&&!$(".folder-modal ul.attachments li[data-id='"+m+"']").hasClass("selected")&&$(".folder-modal ul.attachments li[data-id='"+m+"']").trigger("click")}),E=folders_media_options.terms,t=parseInt(folders_media_options.is_key_active),s=parseInt(folders_media_options.folders),n=folders_media_options.folder_settings,$(document).on("click",".header-posts a.all-posts",function(a){q=0,w="",o="all",$(".active-item").removeClass("active-item"),$(".jstree-clicked").removeClass("jstree-clicked"),$(this).addClass("active-item"),$(".sticky-folders .active-item").removeClass("active-item"),$(this).closest(".media-frame").find("#media-attachment-taxonomy-filter").val("all").trigger("change"),$(this).closest(".media-frame").find(".folder_for_media").val("all").trigger("change"),ad()}),$(document).on("click",".un-categorised-items",function(a){q=0,w="",o="unassigned",$(".active-item").removeClass("active-item"),$(".sticky-folders .active-item").removeClass("active-item"),$(".jstree-clicked").removeClass("jstree-clicked"),$(this).addClass("active-item"),$(this).closest(".media-frame").find("#media-attachment-taxonomy-filter").val("unassigned").trigger("change"),$(this).closest(".media-frame").find(".folder_for_media").val("-1").trigger("change"),ad()}),$(document).on("click","#js-tree-menu a.jstree-anchor",function(c){$("#dynamic-tree-folders .jstree-clicked").removeClass("jstree-clicked"),$("#media-attachment-dynamic-filter").val("dynamic-folders");var b,a=$(this).closest("li.jstree-node").attr("id");o=q=a,$(this).closest(".folder-modal").find(".active-item").removeClass("active-item"),$(this).closest(".folder-modal").find("#media-attachment-taxonomy-filter").val(a),$(this).closest(".folder-modal").find("#media-attachment-taxonomy-filter").trigger("change"),b=thisSlug=af(a,"slug"),$.ajax({url:folders_media_options.ajax_url,type:"post",data:"action=save_folder_last_status&post_type="+folders_media_options.post_type+"&post_id="+b+"&nonce="+folders_media_options.nonce,cache:!1,async:!1,success:function(){}}),$(".custom-media-select").removeClass("active"),ad()}),$(document).on("click","#dynamic-tree-folders a.jstree-anchor",function(b){$("#media-attachment-taxonomy-filter").val("all"),q="",o="",$(".active-item").removeClass("active-item"),$(".sticky-folders .active-item").removeClass("active-item"),$("#js-tree-menu .jstree-clicked").removeClass("jstree-clicked");var a=$(this).closest("li.jstree-node").attr("id");$("#media-attachment-dynamic-filter").val(a).trigger("change"),ad()}),$(document).on("change",".folder_for_media",function(){"add-folder"!=$(this).val()&&null!=$(this).val()?o=$(this).val():"add-folder"==$(this).val()&&(o=-1)}),$(document).on("change","#media-attachment-dynamic-filter",function(){"dynamic-folders"!=$(this).val()&&$("#media-attachment-taxonomy-filter").val("all")}),$(document).on("change","#media-attachment-taxonomy-filter",function(){"all"!=$(this).val()&&$("#media-attachment-dynamic-filter").val("dynamic-folders")}),$(document).on("click",".update-inline-record",function(a){var b;a.stopImmediatePropagation(),a.stopPropagation(),0!=folders_media_options.can_manage_folder&&(isHigh=$(this).closest("li.sticky-fldr").hasClass("is-high"),isLocked=$(this).closest("li.sticky-fldr").hasClass("is-locked"),isSticky=$(this).closest("li.sticky-fldr").hasClass("is-sticky"),isStickyClass=!!isSticky,$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),menuHtml="<div class='dynamic-menu "+(isLocked?"is-locked":"")+" "+(H?"no-key":"")+" ' data-id='"+$(this).closest("li").data("folder-id")+"'><ul>",H||h?menuHtml+="<li class='new-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>New Sub-folder</a></li>":menuHtml+="<li class='new-folder-pro'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>New Sub-folder (Activate)</a></li>",menuHtml+="<li class='rename-folder'><a href='javascript:;'><span class=''><i class='pfolder-edit'></i></span>Rename</a></li>",H?menuHtml+="<li class='sticky-folder'><a href='javascript:;'><span class='sticky-pin'><i class='pfolder-pin'></i></span>"+(isStickyClass?"Remove Sticky Folder":"Sticky Folder")+"</a></li>":menuHtml+="<li class='sticky-folder-pro'><a target='_blank' href='"+folders_media_options.register_url+"'><span class='sticky-pin'><i class='pfolder-pin'></i></span>Sticky Folder (Activate)</a></li>",H||g?menuHtml+="<li class='mark-folder'><a href='javascript:;'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?"Remove Star":"Add a Star")+"</a></li>":menuHtml+="<li class='mark-folder-pro'><a target='_blank' href='"+folders_media_options.register_url+"'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?"Remove Star (Activate)":"Add a Star (Activate)")+"</a></li>",H?(menuHtml+="<li class='lock-folder'><a href='javascript:;'><span class='dashicons dashicons-"+(isLocked?"unlock":"lock")+"'></span>"+(isLocked?"Unlock Folder":"Lock Folder")+"</a></li>",menuHtml+="<li class='duplicate-folder'><a href='javascript:;'><span class=''><i class='pfolder-clone'></i></span>Duplicate folder</a></li>"):(menuHtml+="<li class='lock-folder-pro'><a target='_blank' href='"+folders_media_options.register_url+"'><span class='dashicons dashicons-lock'></span>Lock Folder (Activate)</a></li>",menuHtml+="<li class='duplicate-folder-pro'><a target='_blank' href='"+folders_media_options.register_url+"'><span class=''><i class='pfolder-clone'></i></span>Duplicate folder (Activate)</a></li>"),hasPosts=parseInt($(this).closest("a.jstree-anchor").find(".premio-folder-count").text()),hasPosts&&(H?menuHtml+="<li target='_blank' class='download-folder'><a href='javascript:;'><span class=''><i class='pfolder-zip-file'></i></span>Download Zip</a></li>":menuHtml+="<li target='_blank' class='download-folder-pro'><a target='_blank' href='"+folders_media_options.register_url+"'><span class=''><i class='pfolder-zip-file'></i></span>Download Zip (Activate)</a></li>"),menuHtml+="<li class='cut-folders'><a href='javascript:;'><span><i class='pfolder-cut'></i></span>Cut</a></li>",menuHtml+="<li class='copy-folders'><a href='javascript:;'><span><i class='pfolder-copy'></i></span>Copy</a></li>",I&&(menuHtml+="<li class='paste-folders'><a href='javascript:;'><span><i class='pfolder-paste'></i></span>Paste</a></li>"),menuHtml+="<li class='remove-folder'><a href='javascript:;'><span class=''><i class='pfolder-remove'></i></span>Delete</a></li></ul></div>",$("body").append(menuHtml),f!==a.pageX&&f!=a.pageY?($(".dynamic-menu").css("left",a.pageX),$(".dynamic-menu").css("top",a.pageY),b=a.pageY):f!==$(this).offset().top&&f!=$(this).offset().left?($(".dynamic-menu").css("left",$(this).offset().left),$(".dynamic-menu").css("top",$(this).offset().top),b=$(this).offset().top):($(".dynamic-menu").css("left",F),$(".dynamic-menu").css("top",G-10),b=G),b+$(".dynamic-menu").height()>$(window).height()&&$(".dynamic-menu").css("margin-top",$(window).height()-(b+$(".dynamic-menu").height())))}),$(document).on("click","body, html",function(a){$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),$(".folder-order").removeClass("active")}),$(document).on("click",".dynamic-menu, .folder-order",function(a){a.stopPropagation()}),$(document).on("contextmenu",".js-tree-data .jstree-anchor",function(a){return F=a.pageX,G=a.pageY,$(this).find("span.folder-inline-edit").trigger("click"),!1}),$(document).on("click",".folder-actions span.folder-inline-edit",function(a){var b;a.stopImmediatePropagation(),a.stopPropagation(),0!=folders_media_options.can_manage_folder&&(isHigh=$(this).closest("li.jstree-node").hasClass("is-high"),isLocked=$(this).closest("li.jstree-node").hasClass("is-locked"),isSticky=$(this).closest("li.jstree-node").hasClass("is-sticky"),isDefault=$(this).closest("li.jstree-node").hasClass("is-current"),isStickyClass=!!isSticky,$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),menuHtml="<div class='dynamic-menu "+(isLocked?"is-locked":"")+" "+(H?"":"no-key")+"' data-id='"+$(this).closest("li").prop("id")+"'><ul>",H||h?menuHtml+="<li class='new-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>New Sub-folder</a></li>":menuHtml+="<li class='new-folder-pro'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>New Sub-folder (Activate)</a></li>",menuHtml+="<li class='rename-folder'><a href='javascript:;'><span class=''><i class='pfolder-edit'></i></span>Rename</a></li>",H?menuHtml+="<li class='sticky-folder'><a href='javascript:;'><span class='sticky-pin'><i class='pfolder-pin'></i></span>"+(isStickyClass?"Remove Sticky Folder":"Sticky Folder")+"</a></li>":menuHtml+="<li class='sticky-folder-pro'><a target='_blank' href='"+folders_media_options.register_url+"'><span class='sticky-pin'><i class='pfolder-pin'></i></span>Sticky Folder (Activate)</a></li>",H||g?menuHtml+="<li class='mark-folder'><a href='javascript:;'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?"Remove Star":"Add a Star")+"</a></li>":menuHtml+="<li class='mark-folder-pro'><a target='_blank' href='"+folders_media_options.register_url+"'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?"Remove Star (Activate)":"Add a Star (Activate)")+"</a></li>",H?(menuHtml+="<li class='lock-folder'><a href='javascript:;'><span class='dashicons dashicons-"+(isLocked?"unlock":"lock")+"'></span>"+(isLocked?"Unlock Folder":"Lock Folder")+"</a></li>",menuHtml+="<li class='duplicate-folder'><a href='javascript:;'><span class=''><i class='pfolder-clone'></i></span>Duplicate folder</a></li>"):(menuHtml+="<li class='lock-folder-pro'><a target='_blank' href='"+folders_media_options.register_url+"'><span class='dashicons dashicons-lock'></span>Lock Folder (Activate)</a></li>",menuHtml+="<li class='duplicate-folder-pro'><a target='_blank' href='"+folders_media_options.register_url+"'><span class=''><i class='pfolder-clone'></i></span>Duplicate folder (Activate)</a></li>"),hasPosts=parseInt($(this).closest("a.jstree-anchor").find(".premio-folder-count").text()),hasPosts&&(H?menuHtml+="<li target='_blank' class='download-folder'><a href='javascript:;'><span class=''><i class='pfolder-zip-file'></i></span>Download Zip</a></li>":menuHtml+="<li target='_blank' class='download-folder-pro'><a target='_blank' href='"+folders_media_options.register_url+"'><span class=''><i class='pfolder-zip-file'></i></span>Download Zip (Activate)</a></li>"),isDefault?menuHtml+="<li class='remove-default-folder'><a href='javascript:;'><span><i class='pfolder-active-icon'></i></span>Remove default folder</a></li>":menuHtml+="<li class='default-folders'><a href='javascript:;'><span><i class='pfolder-active-icon'></i></span>Open this folder by default</a></li>",menuHtml+="<li class='cut-folders'><a href='javascript:;'><span><i class='pfolder-cut'></i></span>Cut</a></li>",menuHtml+="<li class='copy-folders'><a href='javascript:;'><span><i class='pfolder-copy'></i></span>Copy</a></li>",I&&(menuHtml+="<li class='paste-folders'><a href='javascript:;'><span><i class='pfolder-paste'></i></span>Paste</a></li>"),menuHtml+="<li class='remove-folder'><a href='javascript:;'><span class=''><i class='pfolder-remove'></i></span>Delete</a></li></ul></div>",$("body").append(menuHtml),f!==a.pageX&&f!=a.pageY?($(".dynamic-menu").css("left",a.pageX),$(".dynamic-menu").css("top",a.pageY),b=a.pageY):f!==$(this).offset().top&&f!=$(this).offset().left?($(".dynamic-menu").css("left",$(this).offset().left),$(".dynamic-menu").css("top",$(this).offset().top),b=$(this).offset().top):($(".dynamic-menu").css("left",F),$(".dynamic-menu").css("top",G-10),b=G),b+$(".dynamic-menu").height()>$(window).height()&&$(".dynamic-menu").css("margin-top",$(window).height()-(b+$(".dynamic-menu").height())),$(this).parents("li.jstree-node").addClass("active-menu"))}),$(document).on("click",".dynamic-menu",function(a){a.stopImmediatePropagation(),a.stopPropagation()}),$(document).on("click","body, html",function(){$(".dynamic-menu").remove()}),$(document).on("click",".new-folder-pro",function(a){$(".dynamic-menu").remove(),$("#sub-folder-popup").show()}),$(document).on("change","#media-attachment-taxonomy-filter",function(a){$("#js-tree-menu").hasClass("jstree-default")&&$("#js-tree-menu").jstree(!0).deselect_all(),$("#dynamic-folders").length&&$("#dynamic-folders").hasClass("jstree-default")&&$("#dynamic-folders").jstree(!0).deselect_all(),$(".active-item").removeClass("active-item"),"all"==$(this).val()?$(".all-posts").addClass("active-item"):"unassigned"==$(this).val()?$(".un-categorised-items").addClass("active-item"):($("#js-tree-menu").jstree("select_node",$(this).val()),$(".sticky-folder-"+$(this).val()+" a").addClass("active-item"))}),$(document).on("click",".new-folder",function(a){a.stopPropagation(),q=$(this).closest(".dynamic-menu").data("id"),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),z=!1,A=!1,$("#add-update-folder-title").text("Add a new folder"),as()}),$(document).on("click","#add-new-folder",function(a){q=$("#custom-menu li.active-item").length?$("#custom-menu li.active-item").data("folder-id"):0,z=!1,A=!1,$("#add-update-folder-title").text("Add a new folder"),as()}),$(document).on("submit","#save-folder-form",function(b){if(b.stopPropagation(),b.preventDefault(),r=$("#add-update-folder-name").val(),""==$.trim(r))$(".folder-form-errors").addClass("active"),$("#add-update-folder-name").focus();else{$("#save-folder-data").html('<span class="dashicons dashicons-update"></span>'),$("#add-update-folder").addClass("disabled");var a=q;z&&(a=0),D=0==a?$("#js-tree-menu > ul > li.jstree-node").length:$("#js-tree-menu > ul > li.jstree-node[id='"+a+"'] > ul.jstree-children > li").length+1,$.ajax({url:folders_media_options.ajax_url,data:{parent_id:a,type:folders_media_options.post_type,action:"wcp_add_new_folder",nonce:folders_media_options.nonce,term_id:a,order:D,name:r,is_duplicate:A,duplicate_from:B},method:"post",success:function(c){if(result=$.parseJSON(c),$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),-1==result.status)$("#no-more-folder-credit").show();else if("1"==result.status){if(t=parseInt(result.is_key_active),s=parseInt(result.folders),$("#current-folder").text(s),$("#ttl-fldr").text(10),at(),result.data.length)for(var a=0;a<result.data.length;a++){var d={folder_id:result.data[a].term_id,folder_count:result.data[a].folder_count,is_sticky:result.data[a].is_sticky,is_high:result.data[a].is_high,is_locked:result.data[a].is_locked,nonce:result.data[a].nonce,slug:result.data[a].slug,is_deleted:0},b=result.data[a].title;b=b.replace(/\\/g,""),n.push(d),$("#js-tree-menu").jstree().create_node(result.parent_id,{id:result.data[a].term_id,text:" "+b},"last",function(){$(".jstree-node[id='"+result.data[a].term_id+"']").attr("data-nonce",result.data[a].nonce),$(".jstree-node[id='"+result.data[a].term_id+"']").attr("data-slug",result.data[a].slug),$(".jstree-node[id='"+result.data[a].term_id+"']").attr("data-parent",result.parent_id),$(".jstree-node[id='"+result.data[a].term_id+"'] > a.jstree-anchor .premio-folder-count").text(result.data[a].folder_count)}),$(".folder-modal .jstree-node[id='"+result.parent_id+"']").length&&$(".folder-modal #js-tree-menu").jstree("open_node",$("#"+result.parent_id)),$(".folder-modal .jstree-node[id='"+result.parent_id+"']").length?$(".folder-modal .jstree-node[id='"+result.parent_id+"'] > a.jstree-anchor").trigger("focus"):$(".folder-modal .jstree-node[id='"+result.data[a].term_id+"']").length&&$(".folder-modal .jstree-node[id='"+result.data[a].term_id+"'] > a.jstree-anchor").trigger("focus")}av(),ak(),q=result.term_id,au(0),A&&aj(),A=!1,B=0}else $("#error-folder-popup-message").html(result.message),$("#error-folder-popup").show()}})}return!1}),$(document).on("click",".form-cancel-btn",function(){$(".folder-popup-form").hide(),$(".jstree-node[id='"+q+"']").length?$(".jstree-node[id='"+q+"'] > a.jstree-anchor").trigger("focus"):$("#js-tree-menu .jstree-anchor.jstree-clicked").length&&$("#js-tree-menu .jstree-anchor.jstree-clicked").trigger("focus")}),$(document).on("click",".folder-popup-form",function(a){$(".folder-popup-form").hide(),$(".jstree-node[id='"+q+"']").length?$(".jstree-node[id='"+q+"'] > a.jstree-anchor").trigger("focus"):$("#js-tree-menu .jstree-anchor.jstree-clicked").length&&$("#js-tree-menu .jstree-anchor.jstree-clicked").trigger("focus")}),$(document).on("click",".popup-form-content",function(a){a.stopPropagation()}),document.onkeydown=function(a){a=a||window.event;("key"in a?"Escape"===a.key||"Esc"===a.key:27===a.keyCode)&&$(".folder-popup-form").hide()},$(document).on("click",".rename-folder",function(a){a.stopPropagation(),q=$(this).closest(".dynamic-menu").data("id"),ar(),$(".dynamic-menu").remove()}),$(document).on("click","#inline-update",function(a){$("#js-tree-menu a.jstree-clicked").length&&(q=$("#js-tree-menu a.jstree-clicked").closest("li.jstree-node").attr("id"),ar())}),$(document).on("submit","#update-folder-form",function(a){return a.stopPropagation(),a.preventDefault(),r=$("#update-folder-item-name").val(),""==$.trim(r)?($(".folder-form-errors").addClass("active"),$("#update-folder-item-name").focus()):($("#update-folder-data").html('<span class="dashicons dashicons-update"></span>'),$("#update-folder-item").addClass("disabled"),u=af(q,"nonce"),f==(parentID=$(".jstree-node[id='"+q+"']").closest("li.jstree-node").attr("id"))&&(parentID=0),$.ajax({url:folders_media_options.ajax_url,data:{parent_id:parentID,type:folders_media_options.post_type,action:"wcp_update_folder",nonce:u,term_id:q,order:D,name:r},method:"post",success:function(a){"1"==(result=$.parseJSON(a)).status?($("#js-tree-menu").jstree("rename_node",result.id," "+result.term_title),$(".sticky-folder-"+result.id+" .folder-title").html(result.term_title),null!=(folderPostId=ag(result.id))&&(n[folderPostId].nonce=result.nonce,n[folderPostId].slug=result.slug),$(".folder-popup-form").hide(),$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),av(),$("#media-attachment-taxonomy-filter").length&&au(0)):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(result.message),$("#error-folder-popup").show())}})),!1}),$(document).on("click",".mark-folder",function(a){a.stopPropagation(),u=af(p=$(this).closest(".dynamic-menu").data("id"),"nonce"),$(".form-loader-count").css("width","100%"),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),$.ajax({url:folders_media_options.ajax_url,data:"term_id="+p+"&type="+folders_media_options.post_type+"&action=wcp_mark_un_mark_folder&nonce="+u,method:"post",cache:!1,success:function(a){a=$.parseJSON(a),$(".form-loader-count").css("width","0%"),"1"==a.status?(folderPostId=ag(a.id),"1"==a.marked?($("li.jstree-node[id='"+a.id+"']").addClass("is-high"),$(".sticky-folder-"+a.id).addClass("is-high"),null!=folderPostId&&(n[folderPostId].is_high=1)):($("li.jstree-node[id='"+a.id+"']").removeClass("is-high"),$(".sticky-folder-"+a.id).removeClass("is-high"),null!=folderPostId&&(n[folderPostId].is_high=0)),av(),$(".folder-modal .jstree-node[id='"+a.id+"']").length&&$(".folder-modal .jstree-node[id='"+a.id+"'] > a.jstree-anchor").trigger("focus")):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show())}})}),$(document).on("click",".lock-folder",function(a){a.stopPropagation(),u=af(p=$(this).closest(".dynamic-menu").data("id"),"nonce"),$(".form-loader-count").css("width","100%"),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),$.ajax({url:folders_media_options.ajax_url,data:"term_id="+p+"&type="+folders_media_options.post_type+"&action=wcp_lock_unlock_folder&nonce="+u,method:"post",cache:!1,success:function(a){a=$.parseJSON(a),$(".form-loader-count").css("width","0%"),"1"==a.status?(folderPostId=ag(a.id),"1"==a.marked?($("li.jstree-node[id='"+a.id+"']").addClass("is-locked"),$(".sticky-folder-"+a.id).addClass("is-locked"),null!=folderPostId&&(n[folderPostId].is_locked=1)):($("li.jstree-node[id='"+a.id+"']").removeClass("is-locked"),$(".sticky-folder-"+a.id).removeClass("is-locked"),null!=folderPostId&&(n[folderPostId].is_locked=0)),av(),$(".folder-modal .jstree-node[id='"+a.id+"']").length&&$(".folder-modal .jstree-node[id='"+a.id+"'] > a.jstree-anchor").trigger("focus")):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show())}})}),$(document).on("click",".duplicate-folder",function(a){a.stopPropagation(),q=$(this).closest(".dynamic-menu").data("id"),$(".dynamic-menu").remove(),z=!1,A=!0,$("#add-update-folder-title").text("Duplicating to a new folder"),as()}),$(document).on("click",".remove-folder",function(){$(this).closest(".dynamic-menu").hasClass("is-locked")||(p=$(this).closest(".dynamic-menu").data("id"),q=$(this).closest(".dynamic-menu").data("id"),aq(0),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"))}),$(document).on("click","#remove-folder-item",function(a){a.stopPropagation(),$(".folder-popup-form").addClass("disabled"),$("#remove-folder-item").html('<span class="dashicons dashicons-update"></span>'),u=af(q,"nonce"),y?function b(){if($("#menu-checkbox").is(":checked")&&$("#js-tree-menu input.checkbox:checked").length>0){var a="",c=!1;$("#js-tree-menu input.checkbox:checked").each(function(){a+=$(this).closest("li.jstree-node").attr("id")+",",$(this).closest("li.jstree-node").hasClass("jstree-clicked")&&(c=!0)}),$(".form-loader-count").css("width","100%"),$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_remove_muliple_folder&term_id="+a+"&nonce="+folders_media_options.nonce,method:"post",success:function(a){if(a=$.parseJSON(a),$(".form-loader-count").css("width","0px"),"1"==a.status){for(t=parseInt(a.is_key_active),s=parseInt(a.folders),$("#current-folder").text(s),i=0;i<a.term_ids.length;i++)$(".folder-modal #js-tree-menu").jstree().delete_node(a.term_ids[i]);$("#ttl-fldr").text(10),av(),$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),aj(),ah(),av(),$(".folder-modal #wcp_folder_"+w).length||($(".header-posts a").trigger("click"),w=0)}else window.location.reload();$("#menu-checkbox").attr("checked",!1),$("#js-tree-menu input.checkbox").attr("checked",!1),$("#js-tree-menu").removeClass("show-folder-checkbox")}})}}():$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_remove_folder&term_id="+q+"&nonce="+u,method:"post",success:function(b){if("1"==(b=$.parseJSON(b)).status){var a,c=$(".jstree-node[id='"+(a=q)+"']").next().length?$(".jstree-node[id='"+a+"']").next().attr("id"):$(".jstree-node[id='"+a+"']").prev().length?$(".jstree-node[id='"+a+"']").prev().attr("id"):$(".jstree-node[id='"+a+"']").parent().parent().hasClass("jstree-node")?$(".jstree-node[id='"+a+"']").parent().parent().attr("id"):0;$("#js-tree-menu").jstree().delete_node(q),t=parseInt(b.is_key_active),s=parseInt(b.folders),$("#current-folder").text(s),$("#ttl-fldr").text(10),$(".sticky-folders .sticky-folder-"+q).remove(),av(),$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),aj(),ah(),0!=c&&$(".folder-modal #"+c+"_anchor").length?$(".folder-modal #"+c+"_anchor").trigger("click").focus():$(".header-posts").trigger("click")}else $(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(b.message),$("#error-folder-popup").show()}})}),$(document).on("click","#sort-order-list",function(a){a.stopPropagation(),$(".folder-order").toggleClass("active")}),$(document).on("click","#expand-collapse-list",function(b){b.stopPropagation();var a=0;$(this).hasClass("all-open")?($(this).removeClass("all-open"),a=0,$(this).attr("data-folder-tooltip","Expand"),$("#expand-collapse-list .text").text("Expand"),$("#js-tree-menu").jstree("close_all")):($(this).addClass("all-open"),a=1,$(this).attr("data-folder-tooltip","Collapse"),$("#expand-collapse-list .text").text("Collapse"),$("#js-tree-menu").jstree("open_all")),x="",$("#js-tree-menu .jstree-node:not(.jstree-leaf)").each(function(){x+=$(this).attr("id")+","}),""!=x&&($(".form-loader-count").css("width","100%"),u=folders_media_options.nonce,$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_change_all_status&status="+a+"&folders="+x+"&nonce="+u,method:"post",success:function(a){$(".form-loader-count").css("width","0"),"0"==(a=$.parseJSON(a)).status&&($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show(),window.location.reload(!0))}}))}),$(document).on("click",".folder-sort-menu a",function(a){a.stopPropagation(),a.preventDefault(),$(".form-loader-count").css("width","100%"),$(".folder-order").removeClass("active"),C=$(this).attr("data-sort"),$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_folders_by_order&nonce="+folders_media_options.nonce+"&order="+$(this).attr("data-sort"),method:"post",success:function(a){1==(a=$.parseJSON(a)).status&&($("#js-tree-menu").jstree().destroy(),$("#js-tree-menu").append("<ul></ul>"),$("#js-tree-menu ul").html(a.data),E=a.terms,ao(),Z()),$(".form-loader-count").css("width","0"),al()}})}),$(document).on("click",".jstree-node .jstree-icon",function(){p=$(this).closest("li.jstree-node").attr("id"),folderStatus=$("li.jstree-node[id='"+p+"']").hasClass("jstree-open")?1:0,$(".form-loader-count").css("width","100%"),u=af(p,"nonce"),at(),$.ajax({url:folders_media_options.ajax_url,data:"is_active="+folderStatus+"&action=save_wcp_folder_state&term_id="+p+"&nonce="+u,method:"post",success:function(a){$(".form-loader-count").css("width","0"),"0"==(a=$.parseJSON(a)).status||($("#wcp_folder_"+p).hasClass("active")?($("#wcp_folder_"+p).removeClass("active"),$("#wcp_folder_"+p).find("ul.ui-sortable:first-child > li").slideUp(),folderStatus=0):($("#wcp_folder_"+p).addClass("active"),$("#wcp_folder_"+p).find("ul.ui-sortable:first-child > li").slideDown(),folderStatus=1),av())}})}),$(document).on("keyup","#folder-search",function(){ap()}),$(document).on("change","#folder-search",function(){ap()}),$(document).on("blur","#folder-search",function(){ap()}),$(document).on("click","#menu-checkbox",function(){$(this).is(":checked")?($(".js-tree-data").addClass("show-folder-checkbox"),$("#menu-checkbox").prop("checked",!0)):($(".js-tree-data input.checkbox").attr("checked",!1),$(".js-tree-data").removeClass("show-folder-checkbox"),$("#menu-checkbox").prop("checked",!1))}),$(document).on("click","#menu-checkbox",function(){$(this).is(":checked")?($("#menu-checkbox").prop("checked",!0),$(".js-tree-data").addClass("show-folder-checkbox")):($("#menu-checkbox").prop("checked",!1),$(".js-tree-data input.checkbox").attr("checked",!1),$(".js-tree-data").removeClass("show-folder-checkbox"))}),$(document).on("click",".folder-checkbox, .input-checkbox",function(a){a.stopImmediatePropagation(),a.stopPropagation()}),$(document).on("click",".jstree-node .jstree-icon",function(a){p=$(this).closest("li.jstree-node").attr("id"),folderStatus=$("li.jstree-node[id='"+p+"']").hasClass("jstree-open")?0:1,$(".form-loader-count").css("width","100%"),u=af(p,"nonce"),at(),$.ajax({url:folders_media_options.ajax_url,data:"is_active="+folderStatus+"&action=save_wcp_folder_state&term_id="+p+"&nonce="+u,method:"post",success:function(a){$(".form-loader-count").css("width","0"),"0"==(a=$.parseJSON(a)).status||($("#wcp_folder_"+p).hasClass("active")?($("#wcp_folder_"+p).removeClass("active"),$("#wcp_folder_"+p).find("ul.ui-sortable:first-child > li").slideUp(),folderStatus=0):($("#wcp_folder_"+p).addClass("active"),$("#wcp_folder_"+p).find("ul.ui-sortable:first-child > li").slideDown(),folderStatus=1),av())}})}),$(document).on("click","#inline-remove, .delete-folder-action:not(.disabled)",function(){$("#menu-checkbox").is(":checked")?($(".dynamic-menu").remove(),aq(1)):$("#js-tree-menu a.jstree-clicked").length&&($("#js-tree-menu a.jstree-clicked").closest(".jstree-node").hasClass("is-locked")||(q=$("#js-tree-menu a.jstree-clicked").closest("li.jstree-node").attr("id"),aq(1),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu")))}),$(document).on("click","#js-tree-menu input.checkbox",function(){ad()}),$(document).on("click",".sticky-folder",function(b){b.stopPropagation(),p=$(this).closest(".dynamic-menu").data("id");var a=0;folderPostId=ag(p),$("li.jstree-node[id='"+p+"']").hasClass("is-sticky")?($("li.jstree-node[id='"+p+"']").removeClass("is-sticky"),$(".sticky-folders .sticky-folder-"+q).remove(),null!=folderPostId&&(n[folderPostId].is_sticky=0)):(a=1,$("li.jstree-node[id='"+p+"']").addClass("is-sticky"),null!=folderPostId&&(n[folderPostId].is_sticky=1)),$(".dynamic-menu").hide(),u=af(p,"nonce"),ah(),$.ajax({url:folders_media_options.ajax_url,data:"term_id="+p+"&type="+folders_media_options.post_type+"&action=wcp_make_sticky_folder&nonce="+u+"&status="+a,method:"post",cache:!1,success:function(a){"1"==(a=$.parseJSON(a)).status&&$(".media-modal .jstree-node[id='"+a.id+"']").length&&$(".media-modal .jstree-node[id='"+a.id+"'] > a.jstree-anchor").trigger("focus")}})}),$(document).on("click",".download-folder",function(a){dataNonce=af(p=$(this).closest(".dynamic-menu").data("id"),"nonce"),window.location=folders_media_options.admin_url+"?action=download-folders&folder_id="+p+"&nonce="+dataNonce}),$(document).on("click",".sticky-folders > ul > li > a",function(b){b.stopPropagation();var a=$(this).closest("li").data("folder-id");$(".jstree-node[id='"+a+"']").length&&($(".jstree-clicked").removeClass("jstree-clicked"),$(".active-item").removeClass("active-item"),$("#js-tree-menu").jstree("select_node",w),$(".jstree-node[id='"+a+"'] > a.jstree-anchor").trigger("click"),$(".jstree-node[id='"+a+"'] > a.jstree-anchor").addClass("jstree-clicked"),$(".sticky-folders .sticky-folder-"+a+" a").addClass("active-item"),ad())}),$(document).on("contextmenu",".sticky-fldr >  a",function(a){return a.stopPropagation(),F=a.pageX,G=a.pageY,$(this).find("span.update-inline-record").trigger("click"),!1}),$(document).on("change",".folder_for_media",function(){"add-folder"==$(this).val()&&(z=!0,$("#add-new-folder").trigger("click"))}),$(document).on("click","#custom-menu .ui-icon, #custom-menu h3",function(){$("#custom-menu .active-item").removeClass("active-item"),$(this).closest(".route").addClass("active-item")}),$(document).on("click",".media-menu button.media-menu-item, .media-button-insert",function(){ai()}),$(document).on("click",".undo-button, .undo-folder-action:not(.disabled)",function(){$(".folders-undo-notification").removeClass("active"),$(this).hasClass("copy-paste-action")?(0!=M||0!=k)&&("cut"==K?(0==L&&(L=""),$("#js-tree-menu").jstree("move_node","#"+k,"#"+i,j),O=0,L=0,k=0,j=0):0!=M&&(u=af(q=M,"nonce"),$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_remove_folder&term_id="+q+"&nonce="+u,method:"post",success:function(a){"1"==(a=$.parseJSON(a)).status?($("#js-tree-menu").jstree().delete_node(q),t=parseInt(a.is_key_active),s=parseInt(a.folders),$("#current-folder").text(s),$("#ttl-fldr").text(10),$(".sticky-folders .sticky-folder-"+q).remove(),av(),$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),aj(),ah(),w==q&&$(".header-posts").trigger("click")):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show())}}))):"yes"==folders_media_options.useFolderUndo&&$.ajax({url:folders_media_options.ajax_url,type:"post",data:{post_type:folders_media_options.post_type,nonce:folders_media_options.nonce,action:"wcp_undo_folder_changes"},success:function(b){if($("#undo-done").addClass("active"),$(".undo-folder-action").addClass("disabled"),setTimeout(function(){$("#undo-done").removeClass("active")},2500),aj(),$("#media-attachment-taxonomy-filter").length){var a=parent.wp;f!=a.media&&(a.media.frame.setState("insert"),null!==a.media.frame.content.get()&& void 0!==a.media.frame.content.get().collection?(a.media.frame.content.get().collection.props.set({ignore:+new Date}),a.media.frame.content.get().options.selection.reset()):a.media.frame.library.props.set({ignore:+new Date}))}}})}),$(document).on("click",".close-undo-box",function(a){a.preventDefault(),$("#do-undo").removeClass("active")})}),$(document).ready(function(){$(document).on("click","#remove-from-all-folders:not(.disabled), #remove-from-current-folder:not(.disabled)",function(){$("#remove-from-all-folders, #remove-from-current-folder").addClass("disabled");var a="all";$(this).hasClass("remove-from-current-folder")&&(a="current"),$("#confirm-your-change").hide(),$.ajax({url:folders_media_options.ajax_url,data:{post_id:$("#unassigned_folders").val(),action:"wcp_remove_post_folder",active_folder:w,type:folders_media_options.post_type,folder_id:-1,nonce:folders_media_options.nonce,status:0,taxonomy:w,remove_from:a},method:"post",success:function(a){$("#remove-from-all-folders, #remove-from-current-folder").removeClass("disabled"),av(),aj(),X()}})}),$(document).on("click",".default-folders a",function(d){d.preventDefault();var a=$(this).closest(".dynamic-menu").data("id"),b=ag(a);if($(".dynamic-menu").hide(),null!=b){var c=n[b].slug;folders_media_options.default_folder=c,$.ajax({url:folders_media_options.ajax_url,type:"post",data:"action=save_premio_default_folder&post_type="+folders_media_options.post_type+"&post_slug="+c+"&nonce="+folders_media_options.nonce+"&folder_id="+a,cache:!1,async:!1,success:function(){ak(),"1"==res.status&&$(".folder-modal .jstree-node[id='"+res.folder_id+"']").length&&$(".folder-modal .jstree-node[id='"+res.folder_id+"'] > a.jstree-anchor").trigger("focus")}})}}),$(document).on("click",".remove-default-folder a",function(a){a.preventDefault(),$(".dynamic-menu").hide(),folders_media_options.default_folder="",$.ajax({url:folders_media_options.ajax_url,type:"post",data:"action=remove_premio_default_folder&post_type="+folders_media_options.post_type+"&nonce="+folders_media_options.nonce+"&folder_id="+post_id,cache:!1,async:!1,success:function(){ak(),"1"==res.status&&$(".folder-modal .jstree-node[id='"+res.folder_id+"']").length&&$(".folder-modal .jstree-node[id='"+res.folder_id+"'] > a.jstree-anchor").trigger("focus")}})}),$(document).on("click",".dynamic-menu .copy-folders",function(a){a.stopPropagation(),I=$(this).closest(".dynamic-menu").data("id"),J="copy",$(".dynamic-menu").remove(),av(),$(".folders-undo-notification").removeClass("active"),$("#copy-message").addClass("active"),setTimeout(function(){$("#copy-message").removeClass("active")},5e3),ad(),$(".folder-modal .jstree-node[id='"+I+"']").length&&$(".folder-modal .jstree-node[id='"+I+"'] > a.jstree-anchor").trigger("focus")}),$(document).on("click",".dynamic-menu .cut-folders",function(a){a.stopPropagation(),I=$(this).closest(".dynamic-menu").data("id"),J="cut",$(".dynamic-menu").remove(),av(),$(".folders-undo-notification").removeClass("active"),$("#cut-message").addClass("active"),setTimeout(function(){$("#cut-message").removeClass("active")},5e3),ad(),$(".folder-modal .jstree-node[id='"+I+"']").length&&$(".folder-modal .jstree-node[id='"+I+"'] > a.jstree-anchor").trigger("focus")}),$(document).on("click",".dynamic-menu .paste-folders",function(b){b.stopPropagation();var a=$(this).closest(".dynamic-menu").data("id");0!=I&&""!=I&&a!=I&&("cut"==J?(L=$("#"+I).data("parent"),M=I,O=$("#"+I).index(),$("#js-tree-menu").jstree("move_node","#"+I,"#"+a,0),av(),K="cut",$(".folders-undo-notification").removeClass("active"),$("#paste-message").addClass("active"),setTimeout(function(){$("#paste-message").removeClass("active")},5e3),$(".folder-modal .jstree-node[id='"+a+"']").length&&$(".folder-modal .jstree-node[id='"+a+"'] > a.jstree-anchor").trigger("focus")):ab(I,a),ad(),J="",I=0),$(".dynamic-menu").remove()}),$(document).on("click",".paste-folder-action",function(){(""==w||isNaN(w))&&(w=0),0!=I&&""!=I&&I!=w&&("cut"==J?(L=$("#"+I).data("parent"),M=I,O=$("#"+I).index()+1,""!=w&&0!=w?$("#js-tree-menu").jstree("move_node","#"+I,"#"+w,0):$("#js-tree-menu").jstree("move_node","#"+I,"#",$("#js-tree-menu > ul > li.jstree-node").length),$(".folders-undo-notification").removeClass("active"),$("#paste-message").addClass("active"),setTimeout(function(){$("#paste-message").removeClass("active")},5e3),$(".folder-modal .jstree-node[id='"+w+"']").length&&$(".folder-modal .jstree-node[id='"+w+"'] > a.jstree-anchor").trigger("focus")):((""==w||isNaN(w))&&(w=0),ab(I,w)),ad(),J="",I=0)}),$(document).on("click",".cut-folder-action",function(a){a.stopPropagation(),""!=w&&0!=w&&(I=w,J="cut",$(".folders-undo-notification").removeClass("active"),$("#cut-message").addClass("active"),setTimeout(function(){$("#cut-message").removeClass("active")},5e3),ad(),$(".folder-modal .jstree-node[id='"+w+"']").length&&$(".folder-modal .jstree-node[id='"+w+"'] > a.jstree-anchor").trigger("focus"))}),$(document).on("click",".copy-folder-action",function(a){a.stopPropagation(),""!=w&&0!=w&&(I=w,J="copy",$(".folders-undo-notification").removeClass("active"),$("#copy-message").addClass("active"),setTimeout(function(){$("#copy-message").removeClass("active")},5e3),ad(),$(".folder-modal .jstree-node[id='"+w+"']").length&&$(".folder-modal .jstree-node[id='"+w+"'] > a.jstree-anchor").trigger("focus"))}),"attachment"==folders_media_options.post_type&&$(".upload-media-action").removeClass("disabled")}),$(document).ready(function(){"yes"==folders_media_options.use_shortcuts&&($(document).on("click",".view-shortcodes",function(a){a.preventDefault(),$("#keyboard-shortcut").show()}),$(document).keydown(function(a){var d=!!a.ctrlKey||!!a.metaKey;if(!($("input").is(":focus")&&!$("textarea").is(":focus"))&&a.shiftKey&&(78==a.keyCode||78==a.which)&&!$(".block-editor-block-list__block").is(":focus")&&$(".folder-modal").length&&(a.preventDefault(),$("#add-new-folder").trigger("click")),(113==a.keyCode||113==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(q=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),ar(),$(".dynamic-menu").remove()),d&&(67==a.keyCode||67==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(I=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),J="copy",$(".folders-undo-notification").removeClass("active"),$("#copy-message").addClass("active"),setTimeout(function(){$("#copy-message").removeClass("active")},5e3),ad()),d&&(88==a.keyCode||88==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(a.preventDefault(),I=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),J="cut",$(".folders-undo-notification").removeClass("active"),$("#cut-message").addClass("active"),setTimeout(function(){$("#cut-message").removeClass("active")},5e3),ad()),d&&(86==a.keyCode||86==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(a.preventDefault(),(""==(w=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"))||isNaN(w))&&(w=0),0!=I&&""!=I&&I!=w&&("cut"==J?(L=$("#"+I).data("parent"),M=I,O=$("#"+I).index()+1,""!=w&&0!=w?$("#js-tree-menu").jstree("move_node","#"+I,"#"+w,0):$("#js-tree-menu").jstree("move_node","#"+I,"#",$("#js-tree-menu > ul > li.jstree-node").length),$(".folders-undo-notification").removeClass("active"),$("#paste-message").addClass("active"),setTimeout(function(){$("#paste-message").removeClass("active")},5e3)):((""==w||isNaN(w))&&(w=0),ab(I,w)),ad(),J="",I=0)),d&&(68==a.keyCode||68==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(a.preventDefault(),q=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),$(".dynamic-menu").remove(),z=!1,A=!0,$("#add-update-folder-title").text("Duplicating to a new folder"),as()),d&&(75==a.keyCode||75==a.which)&&$("#keyboard-shortcut").show(),d&&(40==a.keyCode||40==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){q=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");var b=parseInt($(".folder-modal #"+q).data("parent")),c=parseInt($(".folder-modal #"+q).index())+1,e=parseInt($(".folder-modal #"+q).data("child"));isNaN(b)&&(b=$(".folder-modal li#"+q).parents("li.jstree-node").length?$(".folder-modal li#"+q).parents("li.jstree-node").data("folder"):0,e=$(".folder-modal li#"+q).parents("li.jstree-node").length?$(".folder-modal li#"+q).parents("li.jstree-node").children():$(".folder-modal #js-tree-menu > ul > li").length),0==b&&(b=""),e==c?$(".folder-modal #js-tree-menu").jstree("move_node","#"+q,"#"+b,0):$(".folder-modal #js-tree-menu").jstree("move_node","#"+q,"#"+b,c+1)}if(d&&(38==a.keyCode||38==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){q=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");var b=parseInt($(".folder-modal #"+q).data("parent")),c=parseInt($(".folder-modal #"+q).index())-1,e=parseInt($(".folder-modal #"+q).data("child"));isNaN(b)&&(c=parseInt($("#"+q).index())-1,b=$(".folder-modal li#"+q).parents("li.jstree-node").length?$(".folder-modal li#"+q).parents("li.jstree-node").data("folder"):0,e=$(".folder-modal li#"+q).parents("li.jstree-node").length?$(".folder-modal li#"+q).parents("li.jstree-node").children():$(".folder-modal #js-tree-menu > ul > li").length),0==b&&(b=""),-1==c?$(".folder-modal #js-tree-menu").jstree("move_node","#"+q,"#"+b,e):$(".folder-modal #js-tree-menu").jstree("move_node","#"+q,"#"+b,c)}if((46==a.keyCode||46==a.which||8==a.keyCode||8==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&($(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").hasClass("is-locked")||(q=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),aq(0),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"))),d&&(40==a.keyCode||40==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){q=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");var b=parseInt($("#"+q).data("parent")),c=parseInt($("#"+q).index())+1,e=parseInt($("#"+q).data("child"));0==b&&(b=""),e==c?$(".folder-modal #js-tree-menu").jstree("move_node","#"+q,"#"+b,0):$(".folder-modal #js-tree-menu").jstree("move_node","#"+q,"#"+b,c+1)}if(d&&(38==a.keyCode||38==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){q=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");var b=parseInt($("#"+q).data("parent")),c=parseInt($("#"+q).index())-1,e=parseInt($("#"+q).data("child"));0==b&&(b=""),-1==c?$(".folder-modal #js-tree-menu").jstree("move_node","#"+q,"#"+b,e):$(".folder-modal #js-tree-menu").jstree("move_node","#"+q,"#"+b,c)}(27==a.keyCode||27==a.which)&&$(".folder-popup-form").hide()}))})})